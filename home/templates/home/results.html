{% extends 'base.html' %}

{% block content %}
    <div class="flex">
        <div class="w-full p-5">
            <div dir="rtl" class="flex flex-col rounded p-5">
                {% if words %}
                    {% for word in words %}
                        <div class="flex gap-5 items-center text-dv_white font-faruma rounded-lg"
                             dir="rtl">
                            <h1 class="flex text-6xl font-faruma my-10">
                                {{ word }}
                            </h1>
                            <div id="play-sound_{{ word }}"
                                 class="text-black bg-dv_white p-2 rounded">
                                {% include 'icons/volume-1.svg' %}
                            </div>
                        </div>

                        <audio controls
                               class="hidden"
                               id="audio_{{ word }}"
                               src="https://tts.radheefu.com/audio/?q={{ word }}"
                        >
                        </audio>

                        <script>
                            document.getElementById('play-sound_{{ word }}').addEventListener('click', function () {
                                document.getElementById('audio_{{ word }}').play();
                            });
                        </script>


                        {% for meaning in word.meanings.all %}
                            <div class="leading-loose meanings flex gap-2 flex-wrap my-7">


                                {{ meaning }}


                            </div>

                            <div class="flex gap-2" dir="rtl">
                                <div class="part-of-speech flex flex-row bg-dv_white text-black px-5 py-2 gap-2 rounded">
                                    <div>
                                        ބަސް ބެހޭ ބައިތަކުގެ ތެރެއިން މިބަސް ވަންނަ ބަޔަކީ :
                                    </div>
                                    <div>
                                        {{ meaning.get_part_of_speech }}
                                    </div>
                                </div>

                                <div class="flex flex-row source bg-dv_white text-black px-5 py-2 gap-2 rounded">
                                    <div>
                                        މާނަ ނެގިފައިވަނީ
                                    </div>
                                    <div>
                                        {{ meaning.source }}
                                    </div>
                                    <div>
                                        އިން
                                    </div>

                                </div>
                            </div>








                        {% endfor %}
                    {% endfor %}
                {% endif %}


                <div dir="rtl" class="flex flex-col my-10 text-center text-3xl" hx-trigger="every 3s"
                     hx-get="/hx/{{ word }}/{{ session_key }}" hx-swap="outerHTML">
                    {#                       {% include 'home/hx_comps/on_the_web.html' %}#}
                    <div class="flex flex-wrap gap-5 animate-pulse">
                        {% include 'icons/sparkle.svg' %}
                        ބަހުގެ މިސާލުކޮޅެއް ވިކިޕީޑިޔާއިން އެބަ ހޯދާލަން . .
                    </div>


                </div>

                <p class="decoration-dv_red"></p>


                {% include 'home/search_form.html' %}
            </div>
        </div>
    </div>
{% endblock %}


{% block extra_js %}
    <script>
        // for every word inside of .meanings make it a url with the word
        // if the word is nurse it should be /explore/nurse
        // use vanilla js
        const meanings = document.querySelectorAll('.meanings');
        console.log(meanings);
        meanings.forEach(meaning => {
            console.log(meaning.innerHTML);
            const words = meaning.innerHTML.split(' ');
            console.log(words);
            let new_meaning = '';
            for (const word of words) {
                if (word === '') {
                    continue;
                }

                // if a number or punctuation
                if (word.match(/^[0-9]+$/) || word.match(/^[.,:;!?]+$/)) {
                    continue;
                }

                let classText = "hover:text-dv_green text-2xl decoration-dv_red/30 underline cursor-pointer";
                new_meaning += `<a href="/explore/${word}" class="${classText}">${word}</a>`;
            }
            meaning.innerHTML = new_meaning;

        });


        // whenever htmx swaps the content, we need to find the word from the .web-results class and mark it with green color
        document.body.addEventListener('htmx:afterSwap', function (event) {
            const text_sections = document.querySelectorAll('.web-results'); // Use querySelectorAll to select all elements
            const mainWord = "{{ word }}";

            text_sections.forEach(section => {
                const words = section.innerHTML.split(' ');
                let new_text = '';

                for (const word of words) {

                    // if the word is just 1 character
                    if (word.length === 1) {
                        continue;
                    }


                    // if the word has odd number of characters
                    if (word.length % 2 !== 0) {
                        continue;
                    }

                    if (word === mainWord) {
                        new_text += `<span class="text-dv_green">${word}</span>` + ' ';
                    } else {
                        new_text += word + ' ';
                    }
                }

                section.innerHTML = new_text;
            });
        });


    </script>

{% endblock %}