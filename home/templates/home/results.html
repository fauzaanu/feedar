{% extends 'base.html' %}

{% block content %}
    <div class="flex">
        <div class="w-full p-5">
            <div dir="rtl" class="flex flex-col border-2 border-black rounded p-5">

                {% if related_only %}
                    <div class="flex border-y-4 border-dv_red bg-dv_white gap-2 text-primary p-5 text-lg font-faruma"
                         dir="rtl">
                        <div class="bg-dv_red text-dv_white px-5">{{ word }}</div>
                        <div class="">
                            މިބަހުގެ ސީދާ މާނަ ރަދީފުގައި ނެތުމުން،ތިރީގައި މި ހިމަނާލަނީ މި ބަސް މާނައިގައި އެކުލެވޭ
                            އެހެން
                            ބަސްތައް
                        </div>
                    </div>
                {% endif %}

                {% if words %}
                    {% for word in words %}
                        <div class="flex gap-2 items-center text-dv_white font-faruma rounded-lg"
                             dir="rtl">

                            <h1 class="flex text-6xl font-sangu">
                                {{ word }}

                            </h1>
                            <div id="play-sound_{{ word }}"
                                 class="bg-dv_red p-2 rounded border-2 border-dotted border-dv_white">
                                {% include 'icons/volume-1.svg' %}
                            </div>
                        </div>

                        <audio controls
                               class="hidden"
                               id="audio_{{ word }}"
                               src="https://dhivehi.mv/tools/tts/data/?g=female&q={{ word }}"
                        >
                        </audio>

                        <script>
                            document.getElementById('play-sound_{{ word }}').addEventListener('click', function () {
                                document.getElementById('audio_{{ word }}').play();
                            });
                        </script>


                        {% for meaning in word.meanings.all %}
                            <p class="leading-loose meanings flex gap-2 flex-wrap border-b border-dv_white">{{ meaning }}</p>
                        {% endfor %}
                    {% endfor %}
                {% endif %}

                {% if search_result %}
                    <div dir="rtl" class="flex flex-col py-10">
                        <div>
                            <h2 class="text-2xl  mb-2 font-sangu">ބަސްބޭނުން ކުރެވިފައިވާ މަސްދަރުތައް</h2>
                            <div class="flex flex-col gap-2 text-primary">
                                {% for result in search_result %}
                                    <div dir="rtl"
                                         onclick="location.href='{{ result.url }}'"
                                         class="flex flex-col font-mono align-middle justify-center text-right rounded p-5 gap-2 cursor-pointer bg-dv_white "
                                    >

                                        <p class="web-results">
                                            {{ result.text_section }}
                                        </p>

                                        <div class="flex text-sm bg-dv_white rounded w-fit px-5 py-1 shadow underline border-b-2 border-b-dv_red">

                                            {% include 'icons/link-2.svg' with size=10 %}


                                            {{ result.get_domain }}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% include 'home/search_form.html' %}
            </div>
        </div>
    </div>
{% endblock %}


{% block extra_js %}
    <script>
        // for every word inside of .meanings make it a url with the word
        // if the word is nurse it should be /explore/nurse
        // use vanilla js
        var meanings = document.querySelectorAll('.meanings');
        meanings.forEach(function (meaning) {
            // split the meaning into words
            var words = meaning.textContent.split(' ');
            var newMeaning = '';
            words.forEach(function (word) {

                // if the word is empty skip it or if its a space or if its a number
                if (word === '' || word === ' ' || !isNaN(word)) {
                    return;
                }

                newMeaning += '<a href="/explore/' + word + '" class="text-primary leading-loose p-2 rounded bg-white border-b-2 border-dv_green">' + word + '</a> ';
            });
            meaning.innerHTML = newMeaning;
            meaning.classList.add('p-2', 'leading-loose');
        });


        // find the main word from .web-results and place a border around it after adding a span around it
        var webResults = document.querySelectorAll('.web-results');
        const main_word = '{{ word }}';
        webResults.forEach(function (webResult) {
            var words = webResult.textContent.split(' ');
            var newResult = '';
            words.forEach(function (word) {
                console.log(word);
                if (word === '' || word === ' ' || !isNaN(word)) {
                    return;
                }
                if (word === main_word) {
                    newResult += '<span class="text-dv_white px-2 bg-primary rounded">' + word + '</span> ';
                } else {
                    newResult += word + ' ';
                }
            });
            webResult.innerHTML = newResult;
        });


    </script>

{% endblock %}